# ============================================
# NoDap 로컬 개발 환경
# ============================================
# 사용법:
#   docker-compose up -d    # 백그라운드 실행
#   docker-compose ps       # 상태 확인
#   docker-compose logs -f  # 로그 확인
#   docker-compose down     # 중지 및 삭제
# ============================================

version: '3.8'

services:
  # ============================================
  # MySQL 8.0
  # ⚠️ Windows에서 3306 포트가 예약될 수 있어 33060 사용
  # ============================================
  mysql:
    image: mysql:8.0
    container_name: nodap-mysql
    ports:
      - "33060:3306"
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: nodap_db
      TZ: Asia/Seoul
    volumes:
      - nodap-mysql-data:/var/lib/mysql
    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-u", "root", "-proot"]
      interval: 10s
      timeout: 5s
      retries: 5
    restart: unless-stopped

  # ============================================
  # Redis 7
  # ============================================
  redis:
    image: redis:7-alpine
    container_name: nodap-redis
    ports:
      - "6379:6379"
    volumes:
      - nodap-redis-data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    restart: unless-stopped

# ============================================
# 영속 볼륨 (데이터 유지)
# ============================================
volumes:
  nodap-mysql-data:
  nodap-redis-data:
